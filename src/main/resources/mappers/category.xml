<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="category">

	<parameterMap type="com.scglab.connect.services.category.Category" id="category"></parameterMap>
	<resultMap type="com.scglab.connect.services.category.Category" id="category"></resultMap>
	
	<!-- 카테고리 전체 조회 -->
	<select id="findAllCategory" parameterType="map" resultType="map">
		select a.id as category_large_id
				,a.name as category_large_name
				,b.id as category_middle_id
				,b.name as category_middle_name
				,c.id as category_small_id
				,c.name as category_small_name
		from category_large a
			 inner join category_middle b on (b.category_large_id = a.id and b.name is not null)
			 inner join category_small c on (c.category_middle_id  = b.id and c.name is not null)
		where 1=1
		and a.company_id  = #{companyId}
		and a.name is not null
		order by a.sort_index, b.sort_index, c.sort_index
	</select>

	<!-- 카테고리 대분류 목록 -->
	<select id="findCategoryLarge" parameterType="map" resultType="map">
		SELECT *
		FROM category_large
		WHERE company_id = #{companyId}
		ORDER BY name ASC
	</select>
	
	<!-- 카테고리 대분류 상세 -->
	<select id="getCategoryLarge" parameterType="map" resultType="map">
		SELECT *
		FROM   category_large
		WHERE  id = #{id}
	</select>
	
	<!-- 카테고리 대분류 등록 -->
	<insert id="createCategoryLarge" parameterType="map" useGeneratedKeys="true" keyColumn="id" keyProperty="id">
		INSERT INTO (company_id, name, minwon_code, minwon_name, update_member_id)
		VALUES(#{companyId}, #{name}, #{minwonCode}, #{minwonName}, #{loginId})
	</insert>
	
	<!-- 카테고리 대분류 수정 -->
	<update id="updateCategoryLarge" parameterType="map">
		UPDATE category_large 
		SET    name = #{name}, 
		       minwon_code = #{minwonCode}, 
		       minwon_name = #{minwonName}, 
		       update_member_id = #{loginId} 
		WHERE  id = #{id}
	</update>
	
	<!-- 카테고리 대분류 삭제 -->
	<delete id="deleteCategoryLarge" parameterType="map">
		DELETE FROM category_large
		WHERE  id = #{id}
	</delete>
	
	<!-- 카테고리 중분류 목록 -->
	<select id="findCategoryMiddle" parameterType="map" resultType="map">
		SELECT *
		FROM category_middle
		WHERE company_id = #{companyId}
		ORDER BY name ASC
	</select>
	
	<!-- 카테고리 중분류 상세 -->
	<select id="getCategoryMiddle" parameterType="map" resultType="map">
		SELECT *
		FROM  category_middle
		WHERE id = #{id}
	</select>
	
	<!-- 카테고리 중분류 등록 -->
	<insert id="createCategoryMiddle" parameterType="map" useGeneratedKeys="true" keyColumn="id" keyProperty="id">
		INSERT INTO category_middle(company_id, name, category_large_id, minwon_code, minwon_name, update_member_id)
		VALUES(#{companyId}, #{name}, #{categoryLargeId}, #{minwonCode}, #{minwonName}, #{loginId})
	</insert>
	
	<!-- 카테고리 중분류 수정 -->
	<update id="updateCategoryMiddle" parameterType="map">
		UPDATE category_middle 
		SET    name = #{name}, 
		           category_large_id = #{categoryLargeId},
		       minwon_code = #{minwonCode}, 
		       minwon_name = #{minwonName}, 
		       update_member_id = #{loginId} 
		WHERE  id = #{id}
	</update>
	
	<!-- 카테고리 중분류 삭제 -->
	<delete id="deleteCategoryMiddle" parameterType="map">
		DELETE FROM category_middle
		WHERE  id = #{id}
	</delete>
	
	<!-- 카테고리 소분류 목록 -->
	<select id="findCategorySmall" parameterType="map" resultType="map">
		SELECT *
		FROM v_category
		WHERE company_id = #{companyId}
		ORDER BY name ASC
	</select>
	
	<!-- 카테고리 소분류 상세 -->
	<select id="getCategorySmall" parameterType="map" resultType="map">
		SELECT *
		FROM   category_small
		WHERE  id = #{id}
	</select>
	
	<!-- 카테고리 소분류 등록 -->
	<insert id="createCategorySmall" parameterType="map" useGeneratedKeys="true" keyColumn="id" keyProperty="id">
		INSERT INTO category_small(company_id, name, category_middle_id, minwon_code, minwon_name, update_member_id)
		VALUES(#{companyId}, #{name}, #{categoryMiddleId}, #{minwonCode}, #{minwonName}, #{loginId})
	</insert>
	
	<!-- 카테고리 소분류 수정 -->
	<update id="updateCategorySmall" parameterType="map">
		UPDATE category_middle 
		SET    name = #{name}, 
		       category_middle_id = #{categoryMiddleId},
		       minwon_code = #{minwonCode}, 
		       minwon_name = #{minwonName}, 
		       update_member_id = #{loginId} 
		WHERE  id = #{id}
	</update>
	
	<!-- 카테고리 소분류 삭제 -->
	<delete id="deleteCategorySmall" parameterType="map">
		DELETE FROM category_small
		WHERE  id = #{id}
	</delete>
	
	
	
</mapper>